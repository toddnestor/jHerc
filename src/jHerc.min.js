if("function"!=typeof $&&"function"!=typeof jQuery)throw new Error("jHerc is a jQuery plugin and therefore requires jQuery to run.");!function(e){e.herc={api_url:"http://api.hercdev.io",config:{},fb_login_url:function(){return this.api_url+"/connectFB?api_key="+this.config.api_key},beforeSend:function(t){var r=localStorage.getItem("herc_user");if(r&&(r=JSON.parse(r)),r&&r.access_token&&t.setRequestHeader("Authorization","Basic "+r.access_token),!e.herc.config||!e.herc.config.api_key)throw new Error("You must setup your Api Key to communicate with the Herc API.");t.setRequestHeader("ApiKey",e.herc.config.api_key)},getAll:function(t,r,n,a){var o=this.api_url+"/"+t,i=[];r&&e.each(r,function(e,t){var r=e+"="+encodeURIComponent(t);i.push(r)}),i.length>0&&(o+="?"+i.join("&"));var c={method:"GET",url:o};return this.ajaxRequest(c,n,a)},getOne:function(e,t,r,n){var a=this.api_url+"/"+e+"/"+t,o={method:"GET",url:a};return this.ajaxRequest(o,r,n)},post:function(e,t,r,n){var a=this.api_url+"/"+e,o={method:"POST",url:a,data:t};return this.ajaxRequest(o,r,n)},put:function(e,t,r,n,a){var o=this.api_url+"/"+e+"/"+t;r=r||{},r._method="put";var i={method:"POST",url:o,data:r};return this.ajaxRequest(i,n,a)},ajaxRequest:function(t,r,n){var a={type:t.method?t.method:"POST",url:t.url,dataType:"json",beforeSend:this.beforeSend};return t.data&&(a.data=t.data),a.success=function(t){e.herc.metaDataIze(t),e.herc.metaDataIzeAll(t),"function"==typeof r&&r(t)},"function"==typeof n&&(a.error=n),e.ajax(a)},metaDataIzeAll:function(t){e.each(t,function(t,r){r&&r.meta&&e.herc.metaDataIze(r)})},metaDataIze:function(t){t&&t.meta&&(t.meta_data={},e.each(t.meta,function(e,r){t.meta_data[r.key]=r.value}))},Posts:function(){return e.herc.Abstract("Post")},Tasks:function(){return e.herc.Abstract("Task")},Objects:function(){return e.herc.Abstract("Object")},Users:function(){return e.herc.Abstract("User")},Abstract:function(t){return{getAll:function(r,n,a){return e.herc.getAll(t,r,n,a)},getOne:function(r,n,a){return e.herc.getOne(t,r,n,a)},post:function(r,n,a){return e.herc.post(t,r,n,a)},put:function(r,n,a,o){return e.herc.put(t,r,n,a,o)}}},loginWithAccessToken:function(t){var r=this.api_url+"/loginWithAccessToken",n={url:r,data:{access_token:t}};this.ajaxRequest(n,function(t){if("undefined"!=typeof t.id&&"undefined"!=typeof t.access_token){localStorage.setItem("herc_user",JSON.stringify(t));var r=location.origin+location.pathname,n=e.herc.getAllQueryVariables,a=[];n&&n.length>0&&e.each(n,function(e,t){"access_token"!=e&&a.push(e+"="+encodeURIComponent(t))}),a.length>0&&(r+="?"+a.join("&")),location.href=r}})},getQueryVariable:function(e){for(var t=window.location.search.substring(1),r=t.split("&"),n=0;n<r.length;n++){var a=r[n].split("=");if(a[0]==e)return a[1]}return!1},getAllQueryVariables:function(){var e={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(t,r,n){e[r]=decodeURIComponent(n)});return e},configure:function(t){t.api_key&&(this.config.api_key=t.api_key),e.herc.getQueryVariable("access_token")&&e.herc.loginWithAccessToken(e.herc.getQueryVariable("access_token"))},current_user:function(){var e=localStorage.getItem("herc_user");return e&&(e=JSON.parse(e)),e?e:!1}},e.fn.fbLoginButton=function(){return this.css("cursor","pointer"),this.click(function(t){t.preventDefault(),location.href=e.herc.fb_login_url()+"&redirect_url="+location.href}),e.herc.current_user()&&this.hide(),this}}(jQuery);
