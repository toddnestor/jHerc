if("function"!=typeof $&&"function"!=typeof jQuery)throw new Error("jHerc is a jQuery plugin and therefore requires jQuery to run.");!function(a){a.herc={api_url:"https://api.hercdev.io",config:{},fb_login_url:function(){return this.api_url+"/connectFB?api_key="+this.config.api_key},beforeSend:function(b){var c=localStorage.getItem("herc_user");if(c&&(c=JSON.parse(c)),c&&c.access_token&&b.setRequestHeader("Authorization","Basic "+c.access_token),!a.herc.config||!a.herc.config.api_key)throw new Error("You must setup your Api Key to communicate with the Herc API.");b.setRequestHeader("ApiKey",a.herc.config.api_key)},getAll:function(b,c,d,e){var f=this.api_url+"/"+b,g=[];c&&a.each(c,function(a,b){var c=a+"="+encodeURIComponent(b);g.push(c)}),g.length>0&&(f+="?"+g.join("&"));var h={method:"GET",url:f};return this.ajaxRequest(h,d,e)},getOne:function(a,b,c,d){var e=this.api_url+"/"+a+"/"+b,f={method:"GET",url:e};return this.ajaxRequest(f,c,d)},post:function(a,b,c,d){var e=this.api_url+"/"+a,f={method:"POST",url:e,data:b};return this.ajaxRequest(f,c,d)},put:function(a,b,c,d,e){var f=this.api_url+"/"+a+"/"+b;c=c||{},c._method="put";var g={method:"POST",url:f,data:c};return this.ajaxRequest(g,d,e)},ajaxRequest:function(b,c,d){var e={type:b.method?b.method:"POST",url:b.url,dataType:"json",beforeSend:this.beforeSend};return b.data&&(e.data=b.data),e.success=function(b){a.herc.metaDataIze(b),a.herc.metaDataIzeAll(b),"function"==typeof c&&c(b)},"function"==typeof d&&(e.error=d),a.ajax(e)},metaDataIzeAll:function(b){a.each(b,function(b,c){c&&c.meta&&a.herc.metaDataIze(c)})},metaDataIze:function(b){b&&b.meta&&(b.meta_data={},a.each(b.meta,function(a,c){b.meta_data[c.key]=c.value}))},Posts:function(){return a.herc.Abstract("Post")},Tasks:function(){return a.herc.Abstract("Task")},Objects:function(){return a.herc.Abstract("Object")},Users:function(){return a.herc.Abstract("User")},Abstract:function(b){return{getAll:function(c,d,e){return a.herc.getAll(b,c,d,e)},getOne:function(c,d,e){return a.herc.getOne(b,c,d,e)},post:function(c,d,e){return a.herc.post(b,c,d,e)},put:function(c,d,e,f){return a.herc.put(b,c,d,e,f)}}},loginWithAccessToken:function(b){var c=this.api_url+"/loginWithAccessToken",d={url:c,data:{access_token:b}};this.ajaxRequest(d,function(b){if("undefined"!=typeof b.id&&"undefined"!=typeof b.access_token){localStorage.setItem("herc_user",JSON.stringify(b));var c=location.origin+location.pathname,d=a.herc.getAllQueryVariables,e=[];d&&d.length>0&&a.each(d,function(a,b){"access_token"!=a&&e.push(a+"="+encodeURIComponent(b))}),e.length>0&&(c+="?"+e.join("&")),location.href=c}})},getQueryVariable:function(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}return!1},getAllQueryVariables:function(){var a={};window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=decodeURIComponent(d)});return a},configure:function(b){b.api_key&&(this.config.api_key=b.api_key),a.herc.getQueryVariable("access_token")&&a.herc.loginWithAccessToken(a.herc.getQueryVariable("access_token"))},current_user:function(){var a=localStorage.getItem("herc_user");return a&&(a=JSON.parse(a)),!!a&&a}},a.fn.fbLoginButton=function(){return this.css("cursor","pointer"),this.click(function(b){b.preventDefault(),location.href=a.herc.fb_login_url()+"&redirect_url="+location.href}),a.herc.current_user()&&this.hide(),this}}(jQuery);
